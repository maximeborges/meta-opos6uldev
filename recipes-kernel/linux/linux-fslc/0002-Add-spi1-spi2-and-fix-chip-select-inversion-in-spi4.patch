From 74560eefd0431a8a36699706f028d35dabb25ff4 Mon Sep 17 00:00:00 2001
From: Maxime Borges <maxime.borges@strataggem.com>
Date: Fri, 9 Nov 2018 21:15:01 +0000
Subject: [PATCH] Add spi1, spi2 and fix chip select inversion in spi4

---
 arch/arm/boot/dts/imx6ul-imx6ull-opos6uldev.dtsi | 87 +++++++++++++++++++++++-
 1 file changed, 85 insertions(+), 2 deletions(-)

diff --git a/arch/arm/boot/dts/imx6ul-imx6ull-opos6uldev.dtsi b/arch/arm/boot/dts/imx6ul-imx6ull-opos6uldev.dtsi
index b9c08c1..aaeeb87 100644
--- a/arch/arm/boot/dts/imx6ul-imx6ull-opos6uldev.dtsi
+++ b/arch/arm/boot/dts/imx6ul-imx6ull-opos6uldev.dtsi
@@ -140,6 +140,65 @@
 	status = "okay";
 };
 
+&ecspi1 {
+	pinctrl-names = "default";
+	pinctrl-0 = <&pinctrl_ecspi1>;
+	cs-gpios =  <0>, <0>, <0>, <0>;
+	status = "okay";
+
+	spidev0: spi@0 {
+		compatible = "spidev";
+		reg = <0>;
+		spi-max-frequency = <5000000>;
+	};
+
+	spidev1: spi@1 {
+		compatible = "spidev";
+		reg = <1>;
+		spi-max-frequency = <5000000>;
+	};
+
+	spidev2: spi@2 {
+		compatible = "spidev";
+		reg = <2>;
+		spi-max-frequency = <5000000>;
+	};
+
+	spidev3: spi@3 {
+		compatible = "spidev";
+		reg = <3>;
+		spi-max-frequency = <5000000>;
+	};
+
+};
+
+
+&ecspi2 {
+	pinctrl-names = "default";
+	pinctrl-0 = <&pinctrl_ecspi2>;
+	cs-gpios =  <0>, <&gpio3 2 GPIO_ACTIVE_LOW>, <&gpio3 3 GPIO_ACTIVE_LOW>;
+	status = "okay";
+
+	spidev0: spi@0 {
+		compatible = "spidev";
+		reg = <0>;
+		spi-max-frequency = <5000000>;
+	};
+
+	spidev1: spi@1 {
+		compatible = "spidev";
+		reg = <1>;
+		spi-max-frequency = <5000000>;
+	};
+
+	spidev2: spi@2 {
+		compatible = "spidev";
+		reg = <2>;
+		spi-max-frequency = <5000000>;
+	};
+};
+
+
 &ecspi4 {
 	pinctrl-names = "default";
 	pinctrl-0 = <&pinctrl_ecspi4>;
@@ -159,6 +218,7 @@
 	};
 };
 
+
 &i2c1 {
 	pinctrl-names = "default";
 	pinctrl-0 = <&pinctrl_i2c1>;
@@ -243,13 +303,36 @@
 	pinctrl-names = "default";
 	pinctrl-0 = <&pinctrl_gpios>;
 
+	pinctrl_ecspi1: ecspi1grp {
+		fsl,pins = <
+			MX6UL_PAD_CSI_DATA04__ECSPI1_SCLK	0x1b0b0
+			MX6UL_PAD_CSI_DATA06__ECSPI1_MOSI	0x1b0b0
+			MX6UL_PAD_CSI_DATA07__ECSPI1_MISO	0x1b0b0
+			MX6UL_PAD_CSI_DATA05__ECSPI1_SS0	0x1b0b0 /* SS0 */
+			MX6UL_PAD_LCD_DATA05__GPIO3_IO10    0x1b0b0 /* SS1 */
+			MX6UL_PAD_LCD_DATA06__GPIO3_IO11    0x1b0b0 /* SS2 */
+			MX6UL_PAD_LCD_DATA07__GPIO3_IO12    0x1b0b0 /* SS3 */
+		>;
+	};
+
+	pinctrl_ecspi2: ecspi2grp {
+		fsl,pins = <
+			MX6UL_PAD_CSI_DATA00__ECSPI2_SCLK	0x1b0b0
+			MX6UL_PAD_CSI_DATA02__ECSPI2_MOSI	0x1b0b0
+			MX6UL_PAD_CSI_DATA03__ECSPI2_MISO	0x1b0b0
+			MX6UL_PAD_CSI_DATA01__ECSPI2_SS0	0x1b0b0 /* SS0 */
+			MX6UL_PAD_LCD_HSYNC__GPIO3_IO02	    0x1b0b0 /* SS1 */
+			MX6UL_PAD_LCD_VSYNC__GPIO3_IO03     0x1b0b0 /* SS2 */
+		>;
+	};
+
 	pinctrl_ecspi4: ecspi4grp {
 		fsl,pins = <
 			MX6UL_PAD_NAND_DATA04__ECSPI4_SCLK	0x1b0b0
 			MX6UL_PAD_NAND_DATA05__ECSPI4_MOSI	0x1b0b0
 			MX6UL_PAD_NAND_DATA06__ECSPI4_MISO	0x1b0b0
-			MX6UL_PAD_NAND_DATA01__GPIO4_IO03	0x1b0b0
-			MX6UL_PAD_NAND_DATA07__GPIO4_IO09	0x1b0b0
+			MX6UL_PAD_NAND_DATA07__GPIO4_IO09	0x1b0b0 /* SS0 */
+			MX6UL_PAD_NAND_DATA01__GPIO4_IO03	0x1b0b0 /* SS1 */
 		>;
 	};
 
