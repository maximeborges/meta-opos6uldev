From d6b4aca7c610bf58fde8e5f27cafba60356a8ca5 Mon Sep 17 00:00:00 2001
From: Maxime Borges <maxime.borges@strataggem.com>
Date: Sat, 17 Nov 2018 12:15:33 +0000
Subject: [PATCH] Complete dtsi with gpio, spi1, spi2, spi4 with chip select
 based upon gpio, uart1 to uart7, i2c1 to i2c4

---
 arch/arm/boot/dts/imx6ul-imx6ull-opos6uldev.dtsi | 227 ++++++++++++++---------
 1 file changed, 139 insertions(+), 88 deletions(-)

diff --git a/arch/arm/boot/dts/imx6ul-imx6ull-opos6uldev.dtsi b/arch/arm/boot/dts/imx6ul-imx6ull-opos6uldev.dtsi
index 0c860c9..8e7f125 100644
--- a/arch/arm/boot/dts/imx6ul-imx6ull-opos6uldev.dtsi
+++ b/arch/arm/boot/dts/imx6ul-imx6ull-opos6uldev.dtsi
@@ -1,5 +1,5 @@
 /*
- * Copyright 2018 Armadeus Systems <support@armadeus.com>
+ * Copyright 2018 Strataggem <support@strataggem.com>
  *
  * This file is dual-licensed: you can use it either under the terms
  * of the GPL or the X11 license, at your option. Note that this dual
@@ -50,15 +50,6 @@
 		stdout-path = &uart1;
 	};
 
-	backlight {
-		compatible = "pwm-backlight";
-		pwms = <&pwm3 0 191000>;
-		brightness-levels = <0 4 8 16 32 64 128 255>;
-		default-brightness-level = <7>;
-		power-supply = <&reg_5v>;
-		status = "okay";
-	};
-
 	gpio-keys {
 		compatible = "gpio-keys";
 		pinctrl-names = "default";
@@ -66,24 +57,12 @@
 
 		user-button {
 			label = "User button";
-			gpios = <&gpio2 11 GPIO_ACTIVE_LOW>;
+			gpios = <&gpio3 1 GPIO_ACTIVE_LOW>;
 			linux,code = <BTN_MISC>;
 			wakeup-source;
 		};
 	};
 
-	leds {
-		compatible = "gpio-leds";
-
-		user-led {
-			label = "User";
-			pinctrl-names = "default";
-			pinctrl-0 = <&pinctrl_led>;
-			gpios = <&gpio3 4 GPIO_ACTIVE_HIGH>;
-			linux,default-trigger = "heartbeat";
-		};
-	};
-
 	onewire {
 		compatible = "w1-gpio";
 		pinctrl-names = "default";
@@ -133,17 +112,20 @@
 	status = "okay";
 };
 
+/*
 &can2 {
 	pinctrl-names = "default";
 	pinctrl-0 = <&pinctrl_flexcan2>;
 	xceiver-supply = <&reg_5v>;
 	status = "okay";
 };
+*/
+
 
 &ecspi1 {
 	pinctrl-names = "default";
 	pinctrl-0 = <&pinctrl_ecspi1>;
-	cs-gpios =  <0>, <0>, <0>, <0>;
+	cs-gpios =  <&gpio4 26 GPIO_ACTIVE_LOW>, <&gpio3 10 GPIO_ACTIVE_LOW>, <&gpio3 11 GPIO_ACTIVE_LOW>, <&gpio3 12 GPIO_ACTIVE_LOW>;
 	status = "okay";
 
 	spidev1_0: spi@0 {
@@ -176,7 +158,7 @@
 &ecspi2 {
 	pinctrl-names = "default";
 	pinctrl-0 = <&pinctrl_ecspi2>;
-	cs-gpios =  <0>, <0>, <0>;
+	cs-gpios =  <&gpio4 22 GPIO_ACTIVE_LOW>, <&gpio3 2 GPIO_ACTIVE_LOW>, <&gpio3 3 GPIO_ACTIVE_LOW>;
 	status = "okay";
 
 	spidev2_0: spi@0 {
@@ -202,7 +184,7 @@
 &ecspi4 {
 	pinctrl-names = "default";
 	pinctrl-0 = <&pinctrl_ecspi4>;
-	cs-gpios = <0>, <0>;
+	cs-gpios = <&gpio4 9 GPIO_ACTIVE_LOW>, <&gpio4 3 GPIO_ACTIVE_LOW>;
 	status = "okay";
 
 	spidev3_0: spi@0 {
@@ -233,32 +215,25 @@
 	status = "okay";
 };
 
-&i2c4 {
+&i2c3 {
 	pinctrl-names = "default";
-	pinctrl-0 = <&pinctrl_i2c4>;
-	 clock_frequency = <400000>;
+	pinctrl-0 = <&pinctrl_i2c3>;
+	clock_frequency = <400000>;
 	status = "okay";
 };
 
-&pwm3 {
+&i2c4 {
 	pinctrl-names = "default";
-	pinctrl-0 = <&pinctrl_pwm3>;
+	pinctrl-0 = <&pinctrl_i2c4>;
+	 clock_frequency = <400000>;
 	status = "okay";
 };
 
+
 &snvs_pwrkey {
 	status = "disabled";
 };
 
-&tsc {
-	pinctrl-names = "default";
-	pinctrl-0 = <&pinctrl_tsc>;
-	xnur-gpio = <&gpio1 3 GPIO_ACTIVE_LOW>;
-	measure-delay-time = <0xffff>;
-	pre-charge-time = <0xffff>;
-	status = "okay";
-};
-
 &uart1 {
 	pinctrl-names = "default";
 	pinctrl-0 = <&pinctrl_uart1>;
@@ -271,18 +246,45 @@
 	status = "okay";
 };
 
+&uart3 {
+	pinctrl-names = "default";
+	pinctrl-0 = <&pinctrl_uart3>;
+	status = "okay";
+};
+
 &uart4 {
 	pinctrl-names = "default";
 	pinctrl-0 = <&pinctrl_uart4>;
 	status = "okay";
 };
 
+&uart5 {
+	pinctrl-names = "default";
+	pinctrl-0 = <&pinctrl_uart5>;
+	status = "okay";
+};
+
 &uart6 {
 	pinctrl-names = "default";
 	pinctrl-0 = <&pinctrl_uart6>;
 	status = "okay";
 };
 
+&uart7 {
+	pinctrl-names = "default";
+	pinctrl-0 = <&pinctrl_uart7>;
+	status = "okay";
+};
+
+
+&pwm3 {
+	pinctrl-names = "default";
+	pinctrl-0 = <&pinctrl_pwm3>;
+	status = "okay";
+};
+
+
+
 &usbotg1 {
 	pinctrl-names = "default";
 	pinctrl-0 = <&pinctrl_usbotg1_id>;
@@ -308,10 +310,10 @@
 			MX6UL_PAD_CSI_DATA04__ECSPI1_SCLK	0x1b0b0
 			MX6UL_PAD_CSI_DATA06__ECSPI1_MOSI	0x1b0b0
 			MX6UL_PAD_CSI_DATA07__ECSPI1_MISO	0x1b0b0
-			MX6UL_PAD_CSI_DATA05__ECSPI1_SS0	0x1b0b0 /* SS0 */
-			MX6UL_PAD_LCD_DATA05__ECSPI1_SS1        0x1b0b0 /* SS1 */
-			MX6UL_PAD_LCD_DATA06__ECSPI1_SS2        0x1b0b0 /* SS2 */
-			MX6UL_PAD_LCD_DATA07__ECSPI1_SS3        0x1b0b0 /* SS3 */
+			MX6UL_PAD_CSI_DATA05__GPIO4_IO26	0x1b0b0 /* SS0 */
+			MX6UL_PAD_LCD_DATA05__GPIO3_IO10    0x1b0b0 /* SS1 */
+			MX6UL_PAD_LCD_DATA06__GPIO3_IO11    0x1b0b0 /* SS2 */
+			MX6UL_PAD_LCD_DATA07__GPIO3_IO12    0x1b0b0 /* SS3 */
 		>;
 	};
 
@@ -320,9 +322,9 @@
 			MX6UL_PAD_CSI_DATA00__ECSPI2_SCLK	0x1b0b0
 			MX6UL_PAD_CSI_DATA02__ECSPI2_MOSI	0x1b0b0
 			MX6UL_PAD_CSI_DATA03__ECSPI2_MISO	0x1b0b0
-			MX6UL_PAD_CSI_DATA01__ECSPI2_SS0	0x1b0b0 /* SS0 */
-			MX6UL_PAD_LCD_HSYNC__ECSPI2_SS1	        0x1b0b0 /* SS1 */
-			MX6UL_PAD_LCD_VSYNC__ECSPI2_SS2         0x1b0b0 /* SS2 */
+			MX6UL_PAD_CSI_DATA01__GPIO4_IO22	0x1b0b0 /* SS0 */
+			MX6UL_PAD_LCD_HSYNC__GPIO3_IO02	    0x1b0b0 /* SS1 */
+			MX6UL_PAD_LCD_VSYNC__GPIO3_IO03     0x1b0b0 /* SS2 */
 		>;
 	};
 
@@ -331,8 +333,8 @@
 			MX6UL_PAD_NAND_DATA04__ECSPI4_SCLK	0x1b0b0
 			MX6UL_PAD_NAND_DATA05__ECSPI4_MOSI	0x1b0b0
 			MX6UL_PAD_NAND_DATA06__ECSPI4_MISO	0x1b0b0
-			MX6UL_PAD_NAND_DATA07__ECSPI4_SS0	0x1b0b0 /* SS0 */
-			MX6UL_PAD_NAND_DATA01__ECSPI4_SS1	0x1b0b0 /* SS1 */
+			MX6UL_PAD_NAND_DATA07__GPIO4_IO09	0x1b0b0 /* SS0 */
+			MX6UL_PAD_NAND_DATA01__GPIO4_IO03	0x1b0b0 /* SS1 */
 		>;
 	};
 
@@ -343,82 +345,105 @@
 		>;
 	};
 
+	/* Optionnal can bus on XLBee2_Dio1 (Tx) and X XLBee1_DioO (Rx)
 	pinctrl_flexcan2: flexcan2grp {
 		fsl,pins = <
 			MX6UL_PAD_UART2_CTS_B__FLEXCAN2_TX	0x0b0b0
 			MX6UL_PAD_UART2_RTS_B__FLEXCAN2_RX	0x0b0b0
 		>;
 	};
+	*/
+
 
+	/* Pin number: ((GPIO number - 1) x 32) + pin number */
 	pinctrl_gpios: gpiosgrp {
 		fsl,pins = <
-			MX6UL_PAD_GPIO1_IO09__GPIO1_IO09	0x0b0b0
-			MX6UL_PAD_UART3_RX_DATA__GPIO1_IO25	0x0b0b0
-			MX6UL_PAD_UART3_TX_DATA__GPIO1_IO24	0x0b0b0
-			MX6UL_PAD_NAND_RE_B__GPIO4_IO00		0x0b0b0
-			MX6UL_PAD_GPIO1_IO08__GPIO1_IO08	0x0b0b0
-			MX6UL_PAD_UART1_CTS_B__GPIO1_IO18	0x0b0b0
-			MX6UL_PAD_UART1_RTS_B__GPIO1_IO19	0x0b0b0
-			MX6UL_PAD_NAND_WE_B__GPIO4_IO01		0x0b0b0
-			MX6UL_PAD_SNVS_TAMPER0__GPIO5_IO00	0x0b0b0
-			MX6UL_PAD_SNVS_TAMPER2__GPIO5_IO02	0x0b0b0
-			MX6UL_PAD_SNVS_TAMPER3__GPIO5_IO03	0x0b0b0
-			MX6UL_PAD_SNVS_TAMPER4__GPIO5_IO04	0x0b0b0
-			MX6UL_PAD_SNVS_TAMPER5__GPIO5_IO05	0x0b0b0
-			MX6UL_PAD_SNVS_TAMPER6__GPIO5_IO06	0x0b0b0
-			MX6UL_PAD_SNVS_TAMPER7__GPIO5_IO07	0x0b0b0
-			MX6UL_PAD_SNVS_TAMPER8__GPIO5_IO08	0x0b0b0
+			MX6UL_PAD_UART2_CTS_B__GPIO1_IO22		0x0b0b0 /* XLBee2_Dio1 */
+			MX6UL_PAD_UART2_RTS_B__GPIO1_IO23		0x0b0b0 /* XLBee1_DioO */
+			MX6UL_PAD_GPIO1_IO06__GPIO1_IO06		0x0b0b0 /* XLBee1_Dio7 */
+			MX6UL_PAD_GPIO1_IO07__GPIO1_IO07		0x0b0b0 /* IO Expander !INT */
+			MX6UL_PAD_ENET2_TX_DATA0__GPIO2_IO11	0x0b0b0 /*  XLBEE4_DIO9 */
+			MX6UL_PAD_NAND_WE_B__GPIO4_IO01			0x0b0b0 /* XLBEE3_DIO6 */
+			MX6UL_PAD_NAND_RE_B__GPIO4_IO00			0x0b0b0 /* XLBEE3_DIO5 */
+			MX6UL_PAD_NAND_DATA02__GPIO4_IO04		0x0b0b0 /* XLBEE3_DIO9 */
+			MX6UL_PAD_NAND_ALE__GPIO4_IO10			0x0b0b0 /* XLBEE3_DIO10 */
+			MX6UL_PAD_SNVS_TAMPER8__GPIO5_IO08		0x0b0b0 /* XLBEE5_DIO0 */
+			MX6UL_PAD_SNVS_TAMPER7__GPIO5_IO07		0x0b0b0 /* XLBEE5_DIO6 */
+			MX6UL_PAD_SNVS_TAMPER6__GPIO5_IO06		0x0b0b0 /* XLBEE5_DIO5 */
+			MX6UL_PAD_SNVS_TAMPER5__GPIO5_IO05		0x0b0b0 /* XLBEE5_DIO9 */
+			MX6UL_PAD_SNVS_TAMPER4__GPIO5_IO04		0x0b0b0 /* XLBEE5_DIO7 */
+			MX6UL_PAD_SNVS_TAMPER3__GPIO5_IO03		0x0b0b0 /* XLBEE5_DIO8 */
+			MX6UL_PAD_SNVS_TAMPER2__GPIO5_IO02		0x0b0b0 /* XLBEE5_DIO10 */
+			MX6UL_PAD_SNVS_TAMPER1__GPIO5_IO01		0x0b0b0 /* XLBEE2_DIO0 */
+			MX6UL_PAD_SNVS_TAMPER0__GPIO5_IO00		0x0b0b0 /* PPS1 */			
+			MX6UL_PAD_JTAG_TMS__GPIO1_IO11			0x0b0b0 /* XLBEE2_DIO6 */
+			MX6UL_PAD_JTAG_TDO__GPIO1_IO12			0x0b0b0 /* XLBEE2_DIO5 */
+			MX6UL_PAD_JTAG_TDI__GPIO1_IO13			0x0b0b0 /* XLBEE2_DIO9 */
+			MX6UL_PAD_JTAG_TRST_B__GPIO1_IO15		0x0b0b0 /* XLBEE2_DIO8 */
+			MX6UL_PAD_JTAG_TCK__GPIO1_IO14			0x0b0b0 /* XLBEE2_DIO7 */
+			MX6UL_PAD_GPIO1_IO08__GPIO1_IO08		0x0b0b0 /* EVENT1 */
+			MX6UL_PAD_GPIO1_IO09__GPIO1_IO09		0x0b0b0 /* XLBEE1_DIO6 */
+			MX6UL_PAD_UART1_RTS_B__GPIO1_IO19		0x0b0b0 /* XLBEE1_DIO5 */
+			MX6UL_PAD_UART1_CTS_B__GPIO1_IO18		0x0b0b0 /* XLBEE1_DIO9 */
+			MX6UL_PAD_GPIO1_IO01__GPIO1_IO01		0x0b0b0 /* RTC !INT */
+			MX6UL_PAD_GPIO1_IO04__GPIO1_IO04		0x0b0b0 /* RTC !IRQ */
+			MX6UL_PAD_LCD_DATA15__GPIO3_IO20		0x0b0b0 /* XLBEE1_DIO8 */
+			MX6UL_PAD_LCD_DATA14__GPIO3_IO19		0x0b0b0 /* XLBEE1_DIO10 */
+			MX6UL_PAD_LCD_DATA13__GPIO3_IO18		0x0b0b0 /* XLBEE4_DIO0 */
+			MX6UL_PAD_LCD_DATA12__GPIO3_IO17		0x0b0b0 /* XLBEE4_DIO6 */
+			MX6UL_PAD_LCD_DATA11__GPIO3_IO16		0x0b0b0 /* XLBEE4_DIO5 */
+			MX6UL_PAD_LCD_DATA10__GPIO3_IO15		0x0b0b0 /* XLBEE4_DIO7 */
+			MX6UL_PAD_LCD_DATA09__GPIO3_IO14		0x0b0b0 /* XLBEE4_DIO8 */
+			MX6UL_PAD_LCD_DATA08__GPIO3_IO13		0x0b0b0 /* XLBEE4_DIO10 */
+			MX6UL_PAD_LCD_DATA04__GPIO3_IO09		0x0b0b0 /* XLBEE3_DIO0 */
+			MX6UL_PAD_LCD_CLK__GPIO3_IO00			0x0b0b0 /* XLBEE3_DIO08 */
 		>;
 	};
 
-	pinctrl_gpio_keys: gpiokeysgrp {
+	pinctrl_pwm3: pwm3grp {
 		fsl,pins = <
-			MX6UL_PAD_ENET2_TX_DATA0__GPIO2_IO11	0x0b0b0
+			MX6UL_PAD_NAND_ALE__PWM3_OUT		0x1b0b0
 		>;
 	};
 
-	pinctrl_i2c1: i2c1grp {
-		fsl,pins = <
-			MX6UL_PAD_UART4_RX_DATA__I2C1_SDA	0x4001b8b0
-			MX6UL_PAD_UART4_TX_DATA__I2C1_SCL	0x4001b8b0
-		>;
-	};
 
-	pinctrl_i2c2: i2c2grp {
+	pinctrl_gpio_keys: gpiokeysgrp {
 		fsl,pins = <
-			MX6UL_PAD_UART5_RX_DATA__I2C2_SDA	0x4001b8b0
-			MX6UL_PAD_UART5_TX_DATA__I2C2_SCL	0x4001b8b0
+			MX6UL_PAD_LCD_ENABLE__GPIO3_IO01	0x0b0b0
 		>;
 	};
 
-	pinctrl_i2c4: i2c4grp {
+	pinctrl_i2c1: i2c1grp {
 		fsl,pins = <
-			MX6UL_PAD_LCD_DATA02__I2C4_SDA	0x4001b8b0
-			MX6UL_PAD_LCD_DATA03__I2C4_SCL	0x4001b8b0
+			MX6UL_PAD_GPIO1_IO03__I2C1_SDA	0x4001b8b0
+			MX6UL_PAD_GPIO1_IO02__I2C1_SCL	0x4001b8b0
 		>;
 	};
 
-	pinctrl_led: ledgrp {
+	pinctrl_i2c2: i2c2grp {
 		fsl,pins = <
-			MX6UL_PAD_LCD_RESET__GPIO3_IO04		0x0b0b0
+			MX6UL_PAD_CSI_VSYNC__I2C2_SDA	0x4001b8b0
+			MX6UL_PAD_CSI_HSYNC__I2C2_SCL	0x4001b8b0
 		>;
 	};
 
-	pinctrl_pwm3: pwm3grp {
+	pinctrl_i2c3: i2c3grp {
 		fsl,pins = <
-			MX6UL_PAD_NAND_ALE__PWM3_OUT		0x1b0b0
+			MX6UL_PAD_LCD_DATA00__I2C3_SDA	0x4001b8b0
+			MX6UL_PAD_LCD_DATA01__I2C3_SCL	0x4001b8b0
 		>;
 	};
 
-	pinctrl_tsc: tscgrp {
+	pinctrl_i2c4: i2c4grp {
 		fsl,pins = <
-			MX6UL_PAD_GPIO1_IO01__GPIO1_IO01       0xb0
-			MX6UL_PAD_GPIO1_IO02__GPIO1_IO02       0xb0
-			MX6UL_PAD_GPIO1_IO03__GPIO1_IO03       0xb0
-			MX6UL_PAD_GPIO1_IO04__GPIO1_IO04       0xb0
+			MX6UL_PAD_LCD_DATA02__I2C4_SDA	0x4001b8b0
+			MX6UL_PAD_LCD_DATA03__I2C4_SCL	0x4001b8b0
 		>;
 	};
 
+
+
+
 	pinctrl_uart1: uart1grp {
 		fsl,pins = <
 			MX6UL_PAD_UART1_TX_DATA__UART1_DCE_TX	0x1b0b1
@@ -433,6 +458,13 @@
 		>;
 	};
 
+	pinctrl_uart3: uart3grp {
+		fsl,pins = <
+		    MX6UL_PAD_UART3_TX_DATA__UART3_DCE_TX	0x1b0b1
+			MX6UL_PAD_UART3_RX_DATA__UART3_DCE_RX	0x1b0b1
+		>;
+	};
+
 	pinctrl_uart4: uart4grp {
 		fsl,pins = <
 			MX6UL_PAD_UART4_TX_DATA__UART4_DCE_TX	0x1b0b1
@@ -440,6 +472,13 @@
 		>;
 	};
 
+	pinctrl_uart5: uart5grp {
+		fsl,pins = <
+			MX6UL_PAD_UART5_TX_DATA__UART5_DCE_TX	0x1b0b1
+			MX6UL_PAD_UART5_RX_DATA__UART5_DCE_RX	0x1b0b1
+		>;
+	};
+
 	pinctrl_uart6: uart6grp {
 		fsl,pins = <
 			MX6UL_PAD_CSI_MCLK__UART6_DCE_TX	0x1b0b1
@@ -447,6 +486,18 @@
 		>;
 	};
 
+	pinctrl_uart7: uart7grp {
+		fsl,pins = <
+			MX6UL_PAD_LCD_DATA16__UART7_DCE_TX  0x1b0b1
+		    MX6UL_PAD_LCD_DATA17__UART7_DCE_RX	0x1b0b1
+		>;
+	};
+
+
+
+
+
+
 	pinctrl_usbotg1_id: usbotg1idgrp {
 		fsl,pins = <
 			MX6UL_PAD_GPIO1_IO00__ANATOP_OTG1_ID	0x1b0b0
